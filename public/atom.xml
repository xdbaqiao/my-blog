<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[BaQiao的博客]]></title>
  <link href="http://xdbaqiao.github.io/atom.xml" rel="self"/>
  <link href="http://xdbaqiao.github.io/"/>
  <updated>2014-07-13T00:14:33+08:00</updated>
  <id>http://xdbaqiao.github.io/</id>
  <author>
    <name><![CDATA[BaQiao]]></name>
    <email><![CDATA[yexj061761@gmail.com]]></email>
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[某网站造价工程师数据采集]]></title>
    <link href="http://xdbaqiao.github.io/blog/2014/07/12/scrape-cost-engineer-info/"/>
    <updated>2014-07-12T23:35:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2014/07/12/scrape-cost-engineer-info</id>
    <content type="html"><![CDATA[<p>此次采集共完成4415个数据，包括全国部分城市造价工程师的姓名、性别、出生年月、手机、QQ等个人信息，本次数据全部来自互联网，请合法合理使用数据，本人保留权利拒绝任何人将数据用于非法目的。</p>

<p><strong>采集部分数据如下，如有需要全部数据，请联系本人</strong></p>

<pre><code>"会员名称","姓名","性别","出生年月","联系电话","手机","QQ","毕业院校","学历","职称","执业资格","求职类型","注册情况","工作经验","资格证专业","所在地区","希望月薪","登陆IP","个人特长","转会要求","个人简历"             
"zhanghao...","zhanghao","女","——","","13834732962","550254720","","大专","其他","建设部造价师","挂职","初始注册","5年以上","土建","山西省--太原","2000-5000","218.26.223.*","","挂造价，初注。期望年薪：3-3.5万元，土建专业，挂靠地区最好在山西省或周边省市（河北、北京、天津、陕西等）。每三年一付，或两年一付。","本人1997年毕业于太原工业大学，一直从事造价工作，有丰富的实际工作经验。联系：13834732962"             
"2280767","李兵","女","——","04582282218","13845841531","","哈尔滨建筑大学","本科","工程师","建设部造价师","挂职","初始注册","5年以上","土建","黑龙江省--伊春","面议","113.3.91.*","","",""             
"caoyue80...","曹先生","男","1986-12-19","","18502723157","289038025","","本科","工程师","建设部造价师","挂职","初始注册","5年以上","土建","湖北省--武汉","2000-5000","113.57.129.*","","上班时间最好加个qq 请尽量下班以后联系 下午5点半以后 最好是武汉地区的，，外地的跑得累",""             
"ljtmblyp","蓝天","男","——","","15212451538","21595587","","本科","工程师","建设部造价师","挂职","变更注册","5年以上","土建","浙江省--**","2000-5000","60.8.103.*","","造价师内地挂证、转注册、全年社保、三年10.5万、定金3万办转出，办好转出付余款。 可信单位也可0定金办转出。非诚勿扰，谢绝中介！","转注册速度快，可靠，手续简单，即转即用。 明码标价，诚心实意，欢迎单位前来面谈，或者QQ21595587洽谈，一定热情接待陪同！"             
"zlp2001","张立苹","女","1972-10-01","","13820960922","903164216","天津财经学院","本科","其他","建设部造价师","挂职","初始注册","5年以上","土建","天津市--和平","面议","221.238.143.*","","",""             
"liaoxiao...","廖工","女","1981-09-26","","15072045188","443588581","长春工程学院","大专","其他","建设部造价师","挂职","变更注册","5年以上","土建","陕西省--延安","2000-5000","119.100.122.*","","挂湖北武汉地区",""             
"qingyun","qingyun","男","——","","13406906252","2371663052","","本科","工程师","建设部造价师","挂职","初始注册","1-3年","土建","山东省--**","面议","182.39.148.*","","","2013年通过考试"             
"dlf123","豆","男","1987-03-07","","15961054910","123456","","大专","工程师","建设部造价师","全职","初始注册","1-3年","土建","江苏省--徐州","面议","114.233.183.*","","",""             
"tlj369","田工","男","1973-03-29","05468531167","15254616826","2235682416","石油大学","研究生","高级工程师","建设部造价师","挂职","初始注册","5年以上","土建","山东省--东营","2000-5000","202.102.151.*","","期望年薪3-4.5万元。有2本初始证书（土建、安装各一本），最好挂在同一单位。挂靠地区最好在江苏、广东、浙江、安徽、河北、北京或天津。造价师+中级3.5万元左右(两年一付7万元，三年一付10万元，最好是甲级或乙级资质单位)；造价师+高级4万元左右,(一年一付5万元，两年一付9万元，三年一付12万元，最好是甲级或乙级资质单位)。","本人拥有高级会计师和高级审计师职称。最好挂证不挂章。证书已领取，可以进行注册了"             
"fas109","王建新","男","1982-06-12","","15022283826","85851961","华北电力大学","大专","助理工程师","建设部造价师","挂职","初始注册","5年以上","土建","天津市--北辰","面议","221.238.164.*","","","6月5日下证"             
"yylj99","刘女士","女","1983-05-03","","13809025226","185689563","东南大学","研究生","工程师","建设部造价师","挂职","初始注册","1-3年","土建","江苏省--南京","面议","180.109.21.*","","",""             
"11857658...","王慧","女","1982-12-21","","15940024469","1185765853","","大专","工程师","建设部造价师","全职","变更注册","5年以上","土建","辽宁省--沈阳","面议","101.46.204.*","","",""             
"andong_1...","滑跃娟","女","——","","13833664273","362613121","","大专","不限","建设部造价师","挂职","初始注册","5年以上","土建","河北省--廊坊","面议","222.222.79.*","","",""             
"xusumei","徐女士（高级职称）","女","——","13501","13501171019","1052516397","哈尔滨建筑工程学院","本科；职称：北京市给排水高级工程师；注册资格：安装专业注册造价工程师。因经常会到上海出差，希望挂靠上海的单位。","学历：本科；北京市给排水高级工程师；注册资格：安装专业注册造价工程师。因经常会到上海出差，希望挂靠上海的单位。","建设部造价师","挂职","初始注册","不限","安装","北京市--朝阳","面议","49.4.146.*","","希望注册单位在上海。","学历：本科；职称：北京市给排水高级工程师；注册资格：安装专业注册造价工程师。因经常会到上海出差，希望挂靠上海的单位。"             
"76250644","沈工","男","——","","13998785996","76250644","","本科","工程师","建设部造价师","挂职","变更注册","5年以上","安装","辽宁省--盘锦","面议","59.45.15.*","","",""             
"adsyh88","孙妍","女","1974-01-26","","15145985582","2235622890","大庆石油学院","大专","工程师","建设部造价师","挂职","初始注册","5年以上","土建","黑龙江省--绥化","面议","60.15.234.*","","",""             
"criss","朱延刚","男","1978-08-18","","18600660986","285498191","","研究生","其他","建设部造价师","挂职","初始注册","5年以上","土建","北京市--朝阳","面议","106.39.1.*","","",""             
"hblzj168","李先生","男","——","13522290391","010-69076676","1534819747","","大专","工程师","建设部造价师","挂职","初始注册","1-3年","安装","河北省--唐山","面议","221.222.112.*","","","已经注册完毕"             
"skywolf8...","曹工","男","1983-08-14","","15202890110","240503840","","本科","其他","建设部造价师","挂职","初始注册","5年以上","土建","四川省--成都","面议","125.71.217.*","","3年10万一次性付，寻四川除成都外企业挂靠（重庆的条件优厚可考虑）",""             
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[常见的IT类面试题[未完]]]></title>
    <link href="http://xdbaqiao.github.io/blog/2014/07/06/interview/"/>
    <updated>2014-07-06T18:06:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2014/07/06/interview</id>
    <content type="html"><![CDATA[<pre><code>1. 讲述计算机启动过程？            
2. 什么是MBR，有多大？               
3. Linux 第一个进程叫什么名字？              
4. http协议状态码，4XX有什么？              
5. raid2,3,4用途？              
6. traceroute的基本原理是什么？              
7. 翻转字符串              
8. 字符串转数字              
9. crontab 同步时间              
10. mysql nginx apache 的配置文件位置              
11. C++中的容器              
12. 解释$0 $$ $# $! $@ $? $*              
13. python 生成器和修饰器              
14. iptables              
15. Django工作原理              
16. vim 替换1-10行字符
17. ls -al
18. mysql, nginx, apache 优化              
19. 网站加速              
20. uwsgi 应用服务器              
21. ip route add default，网络配置相关              
22. 关于linux的runlevel              
</code></pre>

<p><strong>我的解答</strong></p>

<p>1. 讲述计算机启动过程？</p>

<blockquote><p>计算机从BIOS中启动，BIOS一般位于主板的flash中，计算机上电之后，进入BIOS，进行硬件自检，并决定从哪里（可选u盘，硬盘等）启动计算机操作系统，接着BIOS把控制权交给设备，从设备中的前512字节中，读取MBR，即主引导记录，放入内存，里面保存有硬盘分区表等信息。接着进入启动管理器，常见的有grub，lilo等，交由用户决定启动哪个操作系统。</p></blockquote>

<p>2. 什么是MBR，有多大？</p>

<blockquote><p>Master Boot Record，MBR主引导记录，有512字节，前446个字节是主引导程序，将系统控制转交给用户制定的分区表中的系统;然后是四个分区表，用于记录磁盘分区状况，每个分区表16个字节;最后是结束标志AA55</p></blockquote>

<p>3. Linux 第一个进程叫什么名字？</p>

<blockquote><p>init(1)，是进程号为1的进程，用于开机初始化</p></blockquote>

<p>4. http协议状态码，4XX有什么？</p>

<blockquote><p>400：请求报文错误    401：未认证    403：Forbidden      <br/>
404：not found等</p></blockquote>

<p>5. raid2,3,4用途？</p>

<blockquote><p>raid2 现在用的很少，因为他对大数据有很高读写性能，但少量读写性能不好。它是为超级计算机开发的磁盘阵列，带海明码，在2的n次幂磁盘中设立校验盘。基本思想是在IO到来之后，控制器将数据按位分割，并顺序将每一位数据放置在每一个磁盘中，这样任何数据都能并行读取，提高性能。但这样也不能实现并发IO，因为硬盘被占用。           <br/>
raid3现在用的也很少，因为其校验盘很容易成为性能瓶颈，其将数据分成多“块”，放在N+1个磁盘上，N个磁盘存放数据，1个磁盘存放校验数据   <br/>
raid4也用的很少，其校验也是放置在一个磁盘上，这个磁盘很容易成为性能瓶颈。  <br/>
所以raid2,3,4基本很少见，其主要运用场景是大量数据读写，比如视频，影音等。</p></blockquote>

<p>6. traceroute的基本原理是什么？</p>

<blockquote><p>traceroute主要用于追踪数据包的路由路径，采用icmp协议，数据包经过一个路由器，TTL生存时间将会减一，直到数据包到达目的地或者TTL被置为零。</p></blockquote>

<p>7. 翻转字符串            <br/>
8. 字符串转数字            <br/>
9. crontab 同步时间</p>

<blockquote><p>10 10-16/2 * 7 *  /usr/bin/ntpd -s 133.100.9.2       <br/>
7月十点十分到下午四点十分，每隔两个小时，进行时间同步       <br/>
有面试官问，crontab同步失败，是什么原因，很有可能是环境变量设置有误，找不到相关命令</p></blockquote>

<p>10. mysql nginx apache 的配置文件位置</p>

<blockquote><p>我完全没有料到居然这也能考，不过我确实没有在意，因为平时凭肌肉记忆和自动补全就能找到相关文件，但笔试起来，我却是如此水。。。。       <br/>
自动补全是如此关键，另外我觉得这真没什么可考的。。。      <br/>
以archlinux为例，我在自动补全的帮助下，轻轻松松找到。。。         <br/>
/etc/mysql/my.cnf   /etc/nginx/nginx.conf    /etc/apache2/httpd.conf</p></blockquote>

<p>11. C++中的容器</p>

<blockquote><p>包括顺序容器和关联容器，顺序容器有vector,list,queue,deque,stack等，其属性和操作包括，size,pop,push,top,insert,erase等，关联容器有map，set等，其属性和操作包括insert,find,count,erase等。</p></blockquote>

<p>12. $0 $$ $# $! $@ $? $*</p>

<blockquote><p>$0 程序名     <br/>
$$ 当前进程进程号     <br/>
$# 参数个数           <br/>
$! 后台运行最后一个进行进程号           <br/>
$@ 输入参数组合，形如(&#8220;$1&#8221;, &#8220;$2&#8221;, &#8220;$3&#8221;)        <br/>
$? 前一命令返回码                 <br/>
$* 输入参数组合，形如(&#8220;$1 $2 $3&#8221;)</p></blockquote>

<p>13. python 生成器和修饰器</p>

<blockquote><p>python的生成器就是yield，表示带yield的函数，其实很简单，类似一个list，不同的是，生成器在使用之后会消耗</p></blockquote>

<p>14. iptables</p>

<blockquote><p>iptables有三表五链，分别是nat、filter、mangle表，prerouting、postrouting、output、input、forward链      <br/>
nat表用于DNAT与SNAT，包含两个链，prerouting、postrouting       <br/>
filter表是默认表，包含input、output、forward链      <br/>
mangle表包含postrouting、prerouting和forward链       <br/>
可以分三种情况理解防火墙。第一种是进入的数据，先通过prerouting链，进行地址变换，然后进行路由判断，如果目的地址是本机，则通过input链处理;如果目的地不是本机，则是第二种情况，转发的数据，则先通过forward链处理，判断是否拦截或转发，然后交给postrouting链进行处理;第三种情况是出站的数据，首先通过output链，然后进行路由判断，最后通过postrouting，进行SNAT。</p></blockquote>

<p>15. Django工作原理</p>

<blockquote></blockquote>

<p>16. vim 替换1-10行字符</p>

<blockquote><p>:1,10s/www/wwww/g</p></blockquote>

<p>17. ls -al</p>

<blockquote><p>命令第二列表示，子文件夹数量或者文件硬链接数量</p></blockquote>

<p>18. mysql, nginx, apache 优化            <br/>
19. 网站加速</p>

<blockquote><ol>
<li>前端优化，静态页面加载速度快</li>
<li>CDN分发，负载均衡</li>
<li>nginx, squid代理作cache加速</li>
</ol>
</blockquote>

<p>20. uwsgi 应用服务器</p>

<p>21. ip route add default，网络配置相关</p>

<blockquote><p>archlinux 使用最新的网络管理工具包 iproute2，替代之前的nettools</p>

<p>ip raute add default 192.168.0.0/24 via 192.168.0.1 dev eth0</p></blockquote>

<p>22. 关于linux的runlevel</p>

<blockquote><p>runlevel 0 是 关机      <br/>
runlevel 1 是 单用户模式       <br/>
runlevel 3 是 多用户模式       <br/>
runlevel 5 是 图形界面         <br/>
runlevel 6 是 重启             <br/>
runlevel s 是 单用户模式       <br/>
较旧的发行版 其位置为/etc/inittab</p></blockquote>

<p>23. load 的含义</p>

<blockquote><p>分别表示1分钟、5分钟和15分钟的负载情况
这个负载情况指的是最近时间内，在CPU中，正在运行与准备运行的平均进程数量</p></blockquote>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[我的django博客]]></title>
    <link href="http://xdbaqiao.github.io/blog/2014/06/08/my-django-blog/"/>
    <updated>2014-06-08T23:06:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2014/06/08/my-django-blog</id>
    <content type="html"><![CDATA[<p>用了两年Python，写了两年Python爬虫，水平一直停留在脚本层级。最近受工作的刺激，梳理了一下思绪，发现自己前端后端都有很大的发展潜力。所以先拿Django开刀，练练手。</p>

<p>Linux和Python已经很熟悉了，所以代码写起来也很顺手。下面记录一下本博客的搭建过程。</p>

<p>原来的博客是Octopress，基本上是嗟来之食，拿来就用，底层原理完全没有理会。现在用Django，感觉自然不一样，当然也学习到很多。</p>

<p>我直接在自己的vps上操作，发行版是Debian。        <br/>
首先，安装Django</p>

<blockquote><p>pip install django</p></blockquote>

<p>安装完成验证一下</p>

<blockquote><p>python –c “import djang</p></blockquote>

<p>如果没有输出，则表示安装成功了。     <br/>
运行</p>

<blockquote><p>django-admin.py startproject myblog</p></blockquote>

<p>创建自己的第一个工程，发现在当前目录下，多了文件夹myblog，其中有manage.py，内置众多管理命令。而myblog/myblog 文件夹内也有urls.py, settings.py等关键文件。</p>

<p>执行</p>

<blockquote><p>python manage.py runserver 127.0.0.1:8080</p></blockquote>

<p>就可以在本机浏览器访问了。当然也可以修改ip地址和端口，使远程访问，我就是这样的，因为我直接在vps上操作的。</p>

<p>创建一个博客应用</p>

<blockquote><p>python manage.py startapp sblog</p></blockquote>

<p>会在myblog同级目录下新建sblog目录，里面有models.py, test.py, admin.py, views.py等重要文件。</p>

<p>Django被称为MTV架构，我的理解是，他还是MVC架构，控制器就是整个Django框架，V就是view视图，M就是model进行事物处理，Django多了一个templat模板，模板用于前端展示。</p>

<p><code>M：models.py 进行数据库操作</code>         <br/>
<code>T：template 用于前端展示</code>        <br/>
<code>V：views  用于视图逻辑处理</code></p>

<p>另外urls.py用于解析url超链接，进行视图逻辑分发。</p>

<p>首先我打开了admin，安装完Django之后，默认开启了settings.py 中的全部INSTALLED_APP应用（其中添加sblog应用）以及中间件MIDDLEWARE_CLASSES，其他我都没有修改，数据库使用默认的sqllite3</p>

<p>执行</p>

<blockquote><p>python manage.py syncdb</p></blockquote>

<p>进行数据库同步，创建用户。这样就可以通过127.0.0.1:8080/admin访问管理工具了。</p>

<p>为了使管理工具能管理博客，需要编辑models.py 文件，</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from django.db import models
</span><span class='line'>from django.contrib import admin
</span><span class='line'>
</span><span class='line'>class BQBlog(models.Model):
</span><span class='line'>    title = models.CharField(max_length=200) 
</span><span class='line'>    content = models.TextField() 
</span><span class='line'>timestamp = models.DateTimeField()
</span><span class='line'>class BQBlogAdmin(admin.ModelAdmin)：
</span><span class='line'>list_display = ('title','timestamp')
</span><span class='line'>
</span><span class='line'>admin.site.register(BQBlog, BQBlogAdmin) //运行python manage.py syncdb前需注释</span></code></pre></td></tr></table></div></figure>


<p>使保存在数据库中的博客有标题，内容和时间戳              <br/>
这样就可以在Django管理工具中进行博客管理了。</p>

<p>进入sblog目录，新建文件夹templates进行模板管理</p>

<p>新建文件chapter.html</p>

<p>在views.py 中添加视图逻辑</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from django.shortcuts import render_to_response 
</span><span class='line'>from sblog.models import BQBlog
</span><span class='line'>
</span><span class='line'>def chapter(request):
</span><span class='line'>    posts = BQBlog.objects.all() 
</span><span class='line'>    return render_to_response("chapter.html", {'posts':posts}) </span></code></pre></td></tr></table></div></figure>


<p>myblog文件夹urls.py 中添加url(r&#8217;<sup>$&#8217;,</sup> include(&#8216;blog.urls&#8217;)),              <br/>
sblog文件夹新建urls.py</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>from django.conf.urls import * 
</span><span class='line'>from sblog.views import chapter
</span><span class='line'>
</span><span class='line'>urlpatterns = patterns('', url(r'^$', chapter), )   </span></code></pre></td></tr></table></div></figure>


<p>这样一个基本的、最简单的Django博客就出来了！</p>

<p>最后需要对其进行简单润色。              <br/>
见<a href="http://django-baqiao.tk/"><code>博客http://django-baqiao.tk</code></a></p>

<p>太丑了！以后有时间再修改！</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[学习]]></title>
    <link href="http://xdbaqiao.github.io/blog/2014/03/24/recent-learn/"/>
    <updated>2014-03-24T19:45:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2014/03/24/recent-learn</id>
    <content type="html"><![CDATA[<p>总结一下最近学习的东西，有点乱。。。</p>

<h2>1. keep-alive              </h2>

<p>http基于tcp协议，是一种请求响应机制的协议。       <br/>
所以，它的请求过程是：        <br/>
建立连接（三次握手），请求，响应，断开连接（四次挥手）        <br/>
而如果包含keep-alive属性，则他的请求过程将节省建立连接的过程：          <br/>
建立连接，请求，响应，请求，响应，请求，响应&#8230;.断开连接</p>

<h2>2. 数据库性能优化           </h2>

<p>使用MyISAM存储引擎，加上唯一索引，设置主键         <br/>
（其实可以考虑用innoDB存储引擎，便于设置外键，而且是事务存储引擎）</p>

<p>存储引擎：MyISAM, innoDB, Falcon, Memory, ARCHIVE, CSV, EXAMPLE, MERGE等         <br/>
索引类型：普通索引，唯一索引，Fulltext索引，Hash索引等         <br/>
数据类型的选择，int? tinyint? mediumint? float?double?         <br/>
blob和text 数据列里面的值在长度方面往往差距巨大，所以对他们的删除和修改操作容易产生大量的碎片。</p>

<p>对数据库的某个字段进行检索，加上唯一索引与不加，速度上至少相差一个数量级！</p>

<h2>3. 传输文件           </h2>

<p>高效的文件传输工具rsync         <br/>
<code>rsync -avzSHP --exclude "*.LJPEG" * root@192.168.0.101:/mnt/file_dir</code></p>

<h2>4. HTTP协议相关</h2>

<p>Internet 最基本的通讯单元是数据包，http最基本的单元是消息，http协议有四个重要术语，消息，实体，资源，用户代理。</p>

<p>消息</p>

<pre><code>    1.请求消息：包括请求行，常规标头，请求标头（标头是自由格式的ASCII字符串）          
    2.响应消息：包括响应行，常规标头，响应标头          
</code></pre>

<p>实体，表示封装在消息中的一个资源，实体由标头和可选的主体组成。        <br/>
用户代理，表示客户机，可以是浏览器，爬虫等。用户代理信息会作为请求的一部分，在User-Agent标头中发送。</p>

<p>标头：自由格式的ASCII字符串</p>

<pre><code>       常规标头：Date，Pragma(伪指令，发送给消息接收方，唯一的伪指令pragma：no-cache)
       请求标头：Authorization，From，If-Modified-Since，Referer，User-Agent
       响应标头：Location（将请求重定向可找到资源的地方），Server，WWW-Authorization
       实体标头：Allow，Content-Type，Content-Coding，Content-Length，Expires，Last-Modified
</code></pre>

<p>信息类：1xx                        成功类： 2xx           <br/>
重定向类： 3xx                    客户机错误类：4xx            <br/>
服务器错误类：  5xx</p>

<h2>5.装饰器的用途          </h2>

<p>•  Access control         <br/>
•  Cleanup of temporary objects         <br/>
•  Error handling         <br/>
•  Caching         <br/>
•  Logging</p>

<pre><code>&gt;&gt;&gt; def mom(func):
...     cache = {}
...     def wrapper(*args):
...         if args in cache:
...             return cache[args]
...         print 'Calling %s()' % func.__name__
...         res = func(*args)
...         cache[args] = res
...         return res
...     return wrapper
&gt;&gt;&gt; @mom
... def mum(x,y):
...     return x*y
... 
&gt;&gt;&gt; mum(6,7)
Calling mum()
42
&gt;&gt;&gt; mum(6,7)
42 
</code></pre>

<h2>6.生成器 yield</h2>

<p>yield 就像return， 但不会终止程序，他将值推出函数体，当生成器被call时，这个值被消耗。</p>

<pre><code>&gt;&gt;&gt; def test():
...     for i in range(2):
...         yield i
&gt;&gt;&gt; t=test()
&gt;&gt;&gt; t
&lt;generator object test at 0x7f5609846910&gt;
&gt;&gt;&gt; list(t)
[0, 1, 2]
&gt;&gt;&gt; list(t)
[]
</code></pre>

<h2>7. @property        </h2>

<p>使得类中的方法可以像类属性一样访问（build_in decorator），但不能写，如果要写的话，如下例用@name.setter修饰符，还可以用@name.deleter 删除方法属性</p>

<pre><code>&gt;&gt;&gt; class person:
...     def __init__(self, first_name, last_name):
...         self.f = first_name
...         self.l = last_name
...     @property
...     def name(self):
...         return '%s %s' % (self.f, self.l)
...     @name.setter   #修饰之后，返回value值
...     def name(self, value):
...         return '%s %s' % (self.f, self.l) #所以这句话没意义了
... 
&gt;&gt;&gt; p = person('hello', 'world')
&gt;&gt;&gt; p.name    #不是p.name()
'hello world’
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[梁漱溟：做学问]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/11/19/zuoxuewen/"/>
    <updated>2013-11-19T22:46:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/11/19/zuoxuewen</id>
    <content type="html"><![CDATA[<p><strong>节选自<a href="http://www.ruanyifeng.com/blog/2013/09/liang_shuming.html">阮一峰的网络日志</a></strong></p>

<p>所谓学问，就是对问题说得出道理，有自己的想法。     <br/>
想法似乎人人都是有的，但又等于没有。因为大多数人的头脑杂乱无章，人云亦云，对于不同的观点意见，他都点头称是，等于没有想法。     <br/>
我从来没有想过要做学问，走上现在这条路，只是因为我喜欢提问题。大约从十四岁开始，总有问题占据在我的心里，从一个问题转入另一个问题，一直想如何解答，解答不完就欲罢不能，就一路走了下来。     <br/>
提得出问题，然后想要解决它，这大概是做学问的起点吧。      <br/>
以下分八层来说明我走的一条路：</p>

<h2>第一层境界：形成主见</h2>

<p>用心想一个问题，便会对这个问题有主见，形成自己的判断。        <br/>
说是主见，称之为偏见亦可。我们的主见也许是很浅薄的，但即使浅薄，也终究是你自己的意见。       <br/>
许多哲学家的哲学也很浅，就因为浅便行了，胡适之先生的哲学很浅，亦很行。因为这是他自己的，纵然不高深，却是心得，而亲切有味。所以说出来便能够动人，能动人就行了！他就能自成一派，其他人不行，就是因为其他人连浅薄的哲学都没有。</p>

<h2>第二层境界：发现不能解释的事情</h2>

<p>有主见，才有你自己；有自己，才有旁人，才会发觉前后左右都是与我意见不同的人。     <br/>
这时候，你感觉到种种冲突，种种矛盾，种种没有道理，又种种都是道理。于是就不得不第二步地用心思。       <br/>
面对各种问题，你自己说不出道理，不甘心随便跟着人家说，也不敢轻易自信，这时你就走上求学问的正确道路了。</p>

<h2>第三层境界：融汇贯通</h2>

<p>从此以后，前人的主张、今人的言论，你不会轻易放过，稍有与自己不同处，便知道加以注意。        <br/>
你看到与自己想法相同的，感到亲切；看到与自己想法不同的，感到隔膜。有不同，就非求解决不可；有隔膜，就非求了解不可。于是，古人今人所曾用过的心思，慢慢融汇到你自己。          <br/>
你最初的一点主见，成为以后大学问的萌芽。从这点萌芽，你才可以吸收养料，才可以向上生枝发叶，向下入土生根。待得上边枝叶扶疏，下边根深蒂固，学问便成了。     <br/>
这是读书唯一正确的方法，不然读书也没用处。会读书的人说话时，说他自己的话，不堆砌名词，不旁征博引；反之，引书越多的人越不会读书。</p>

<h2>第四层境界：知不足</h2>

<p>用心之后，就知道要虚心了。自己当初一点见解之浮浅，不足以解决问题。      <br/>
学问的进步，不单是见解有进步，还表现在你的心思头脑锻炼得精密了，心气态度锻炼得谦虚了。      <br/>
心虚思密是求学的必要条件。          <br/>
对于前人之学，总不要说自己都懂。因为自己觉得不懂，就可以除去一切浮见，完全虚心地先求了解它。       <br/>
遇到不同的意见思想，我总疑心他比我高明，疑心他必有我所未及的见闻，不然，他何以不和我作同样判断呢？疑心他必有精思深悟过于我，不然，何以我所见如此而他所见如彼呢？</p>

<h2>第五层境界：以简御繁</h2>

<p>你见到的意见越多，专研得愈深，这时候零碎的知识，片段的见解都没有了；心里全是一贯的系统，整个的组织。如此，就可以算成功了。到了这时候，才能以简御繁，才可以学问多而不觉得多。      <br/>
凡有系统的思想，在心里都很简单，仿佛只有一两句话。凡是大哲学家皆没有许多话说，总不过一两句。很复杂很沉重的宇宙，在他手心里是异常轻松的&#8212;-所谓举重若轻。      <br/>
学问家如说肩背上负着多沉重的学问，那是不对的；如说当初觉得有什么，现在才晓得原来没有什么，那就对了。道理越看得明透，越觉得无甚话可说，还是一点不说的好。心里明白，口里讲不出来。       <br/>
反过来说，学问浅的人说话愈多，思想不清楚的人名词越多。让一个没有学问的人看见，真要把他吓坏了！其实道理明透了，名词便可用，可不用，或随意拾用。</p>

<h2>第六层境界：运用自如</h2>

<p>如果外面或里面还有解决不了的问题，那学问必是没到家。如果学问已经通了，就没有问题。       <br/>
真学问的人，学问可以完全归自己运用。假学问的人，学问在他的手里完全不会用。</p>

<h2>第七层境界：一览众山小</h2>

<p>学问里面的甘苦都尝过了，再看旁人的见解主张，其中得失长短都能够看出来。这个浅薄，那个到家，这个是什么分数，那个是什么程度，都知道得很清楚；因为自己从前也是这样，一切深浅精粗的层次都曾经过。</p>

<h2>第八层境界：通透</h2>

<p>思精理熟之后，心里就没有一点不透的了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[tmux]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/10/22/about-tmux/"/>
    <updated>2013-10-22T09:17:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/10/22/about-tmux</id>
    <content type="html"><![CDATA[<p>一直以来都是在screen上运行远程程序，偶然发现tmux也有这样的功能，我一直把tmux当分屏工具用，看来真是浪费了额。</p>

<p>对比一下：</p>

<pre><code>tmux attach -t baqiao    ===   screen -D -r baqiao

tmux new -s baqiao       ===   screen -S baqiao

tmux ls               ===   screen -list

Ctrl + b, d           ===   Ctrl + a + d
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[python爬虫程序(多线程，get，post，代理，日志)]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/09/01/python-scrape/"/>
    <updated>2013-09-01T15:58:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/09/01/python-scrape</id>
    <content type="html"><![CDATA[<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python2</span>
</span><span class='line'><span class="c">#coding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">string</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">urllib2</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">logging</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">cookielib</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">threading</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">deque</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">set_log</span><span class="p">():</span>
</span><span class='line'>    <span class="n">FMT</span> <span class="o">=</span> <span class="s">&#39;</span><span class="si">%(asctime)s</span><span class="s">-</span><span class="si">%(levelname)s</span><span class="se">\t</span><span class="si">%(message)s</span><span class="s">&#39;</span>
</span><span class='line'>    <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">format</span><span class="o">=</span><span class="n">FMT</span><span class="p">,</span> <span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s">&#39;downloading.log&#39;</span><span class="p">,</span> <span class="n">filemode</span><span class="o">=</span><span class="s">&#39;a&#39;</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">download</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">first_url</span><span class="p">,</span> <span class="n">proxy</span><span class="o">=</span><span class="bp">None</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span> <span class="o">=</span> <span class="s">&#39;Mozilla/5.0 (Windows NT 6.1; WOW64; rv:5.0) Gecko/20100101 Firefox/5.0&#39;</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s">&#39;User-Agent&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_agent</span><span class="p">,</span> <span class="s">&#39;Accept-encoding&#39;</span><span class="p">:</span><span class="s">&#39;gzip, deflate&#39;</span><span class="p">,</span> <span class="s">&#39;Referer&#39;</span><span class="p">:</span> <span class="n">first_url</span><span class="p">}</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">()</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">proxy</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">add_proxy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">proxy</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">proxy</span><span class="p">:</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">url</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s">&#39;https&#39;</span><span class="p">):</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="s">&#39;https&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}))</span>
</span><span class='line'>            <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="o">.</span><span class="n">add_handler</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">ProxyHandler</span><span class="p">({</span><span class="s">&#39;http&#39;</span><span class="p">:</span> <span class="n">proxy</span><span class="p">}))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">)</span>
</span><span class='line'>        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">html</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">post</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">add_proxy</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span class='line'>            <span class="n">data</span> <span class="o">=</span> <span class="n">urllib</span><span class="o">.</span><span class="n">urlencode</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</span><span class='line'>        <span class="n">request</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">Request</span><span class="p">(</span><span class="n">url</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">headers</span><span class="p">)</span>
</span><span class='line'>        <span class="n">response</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">opener</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
</span><span class='line'>        <span class="n">html</span> <span class="o">=</span> <span class="n">response</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">html</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">fetch</span><span class="p">():</span>
</span><span class='line'>    <span class="n">url</span> <span class="o">=</span> <span class="s">&#39;http://medboard.nv.gov/verification/&#39;</span>
</span><span class='line'>    <span class="n">surl</span> <span class="o">=</span> <span class="s">&#39;http://medboard.nv.gov/verification/Search.aspx&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">name</span> <span class="o">=</span> <span class="n">deque</span><span class="p">()</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">string</span><span class="o">.</span><span class="n">lowercase</span><span class="p">:</span>
</span><span class='line'>        <span class="n">name</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">worker</span><span class="p">():</span>
</span><span class='line'>        <span class="n">D</span> <span class="o">=</span> <span class="n">download</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>        <span class="n">D</span><span class="o">.</span><span class="n">opener</span> <span class="o">=</span> <span class="n">urllib2</span><span class="o">.</span><span class="n">build_opener</span><span class="p">(</span><span class="n">urllib2</span><span class="o">.</span><span class="n">HTTPCookieProcessor</span><span class="p">(</span><span class="n">cookielib</span><span class="o">.</span><span class="n">MozillaCookieJar</span><span class="p">()))</span>
</span><span class='line'>        <span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
</span><span class='line'>            <span class="k">try</span><span class="p">:</span>
</span><span class='line'>                <span class="n">letter</span> <span class="o">=</span> <span class="n">name</span><span class="o">.</span><span class="n">popleft</span><span class="p">()</span>
</span><span class='line'>            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
</span><span class='line'>                <span class="k">break</span>
</span><span class='line'>            <span class="n">html</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">url</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>            <span class="n">post_data</span> <span class="o">=</span> <span class="p">{}</span>
</span><span class='line'>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;__VIEWSTATE&quot;\svalue=&quot;([^&quot;]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span class='line'>            <span class="n">post_data</span><span class="p">[</span><span class="s">&#39;__VIEWSTATE&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>            <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">r&#39;__EVENTVALIDATION&quot;\svalue=&quot;([^&quot;]+)&#39;</span><span class="p">,</span> <span class="n">re</span><span class="o">.</span><span class="n">DOTALL</span><span class="o">|</span><span class="n">re</span><span class="o">.</span><span class="n">IGNORECASE</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span class='line'>            <span class="n">post_data</span><span class="p">[</span><span class="s">&#39;__EVENTVALIDATION&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span> <span class="k">if</span> <span class="n">m</span> <span class="k">else</span> <span class="s">&#39;&#39;</span>
</span><span class='line'>            <span class="n">post_data</span><span class="p">[</span><span class="s">&#39;t_web_lookup__license_type_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Medical Doctor&#39;</span>
</span><span class='line'>            <span class="n">post_data</span><span class="p">[</span><span class="s">&#39;t_web_lookup__first_name&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">letter</span>
</span><span class='line'>            <span class="n">post_data</span><span class="p">[</span><span class="s">&#39;sch_button&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Search&#39;</span>
</span><span class='line'>            <span class="n">html</span> <span class="o">=</span> <span class="n">D</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="n">url</span><span class="o">=</span><span class="n">surl</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">post_data</span><span class="p">)</span>
</span><span class='line'>            <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">html</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">muilt_thread</span><span class="p">(</span><span class="n">worker</span><span class="p">,</span> <span class="mi">30</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">muilt_thread</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">num_threads</span><span class="p">,</span> <span class="n">wait</span><span class="o">=</span><span class="bp">True</span><span class="p">):</span>
</span><span class='line'>    <span class="n">threads</span> <span class="o">=</span> <span class="p">[</span><span class="n">threading</span><span class="o">.</span><span class="n">Thread</span><span class="p">(</span><span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">num_threads</span><span class="p">)]</span>
</span><span class='line'>    <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
</span><span class='line'>        <span class="n">thread</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>    <span class="k">if</span> <span class="n">wait</span><span class="p">:</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">thread</span> <span class="ow">in</span> <span class="n">threads</span><span class="p">:</span>
</span><span class='line'>            <span class="n">thread</span><span class="o">.</span><span class="n">join</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">set_log</span><span class="p">()</span>
</span><span class='line'>    <span class="n">fetch</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[python与gnuplot]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/08/15/webserver/"/>
    <updated>2013-08-15T15:53:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/08/15/webserver</id>
    <content type="html"><![CDATA[<p>写了一个测试web服务器性能的简单脚本，运用了apache中的测试工具ab，代码如下：        <br/>
额，这不是什么机密吧，只是一个框架，以后可以加cache机制，加config或者argv，领导不要抓我。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/python</span>
</span><span class='line'><span class="c">#coding:utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="kn">import</span> <span class="nn">re</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">commands</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">Gnuplot</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">nginxTest</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">request_finish_time</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">=</span> <span class="s">&#39;ab -n </span><span class="si">%s</span><span class="s"> -c 10 -k http://localhost/&#39;</span> <span class="c"># 把localhost 换成www.google.com，让暴风雨来的猛烈些吧</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="n">num</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">start</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">for</span> <span class="n">i_num</span><span class="p">,</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">):</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">getOutput</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">parseOutput</span><span class="p">()</span>
</span><span class='line'>            <span class="k">print</span> <span class="s">&#39;Total </span><span class="si">%s</span><span class="s">, finish </span><span class="si">%s</span><span class="s">.&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)),</span> <span class="nb">str</span><span class="p">(</span><span class="n">i_num</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">getOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">num</span><span class="p">):</span>
</span><span class='line'>        <span class="p">(</span><span class="n">status</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span> <span class="o">=</span> <span class="n">commands</span><span class="o">.</span><span class="n">getstatusoutput</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">command</span> <span class="o">%</span> <span class="n">num</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">parseOutput</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="n">m</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="s">&#39;Time taken for tests:\s+([\.\d]+)&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">search</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">output</span><span class="p">)</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">m</span><span class="p">:</span>
</span><span class='line'>            <span class="n">rft</span> <span class="o">=</span> <span class="n">m</span><span class="o">.</span><span class="n">groups</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">request_finish_time</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">rft</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">gnuplot</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">title</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">x</span> <span class="o">=</span> <span class="n">x</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">y</span> <span class="o">=</span> <span class="n">y</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span> <span class="o">=</span> <span class="n">Gnuplot</span><span class="o">.</span><span class="n">Gnuplot</span><span class="p">(</span><span class="n">debug</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>        <span class="n">d</span> <span class="o">=</span> <span class="n">Gnuplot</span><span class="o">.</span><span class="n">Data</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">with_</span><span class="o">=</span><span class="s">&#39;lines&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s">&#39;times&#39;</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">g</span><span class="o">.</span><span class="n">hardcopy</span><span class="p">(</span><span class="s">&#39;./</span><span class="si">%s</span><span class="s">.ps&#39;</span> <span class="o">%</span> <span class="bp">self</span><span class="o">.</span><span class="n">title</span><span class="p">,</span> <span class="n">enhanced</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="n">times</span> <span class="o">=</span> <span class="p">[</span><span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">45</span><span class="p">)]</span>
</span><span class='line'>    <span class="n">n</span> <span class="o">=</span> <span class="n">nginxTest</span><span class="p">(</span><span class="n">num</span><span class="o">=</span><span class="n">times</span><span class="p">)</span>
</span><span class='line'>    <span class="n">n</span><span class="o">.</span><span class="n">start</span><span class="p">()</span>
</span><span class='line'>    <span class="n">gnuplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">times</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="n">n</span><span class="o">.</span><span class="n">request_finish_time</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s">&#39;request finish time&#39;</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p><strong>The result is following</strong></p>

<p><img src="http://imgur.com/okeEBq1.png" alt="request_finish_time" /></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[python2 的编码问题]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/08/09/coding-problem/"/>
    <updated>2013-08-09T20:36:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/08/09/coding-problem</id>
    <content type="html"><![CDATA[<p>编码涉及到很多问题，本文简单讲一讲</p>

<p>写python脚本的时候，头两行的常见格式是：</p>

<pre><code>#!/usr/bin/env python2                  
#coding:utf-8               
</code></pre>

<p>第一行的意义是在Linux下，当脚本是可执行文件是，以&#8221;./*.py&#8221;执行程序时需要调用的命令，如果以命令&#8217;python  *.py&#8217;执行程序，则第一行是没有意义的              <br/>
第二行涉及到python编码问题，它指定脚本内容的编码方式。这一行的写法很灵活，但必须包含三项内容，即&#8221;#&#8221;, &#8220;coding&#8221; 和编码   <br/>
所以，也可以写作<code># -*- coding: UTF-8 -*-</code></p>

<p><strong>基本知识</strong>               <br/>
在讲python编码之前，需要了解一些基本知识：         <br/>
1. python有两种字符串类型，str和unicode，例如</p>

<pre><code>&gt;&gt;&gt; a = u'你好'          
&gt;&gt;&gt; a.__class__             
&lt;type 'unicode'&gt;           
&gt;&gt;&gt; a = '你好'           
&gt;&gt;&gt; a.__class__      
&lt;type 'str'&gt;          
</code></pre>

<p>2. python里       <br/>
encode是指将unicode 转换成  其他编码</p>

<pre><code>encode： unicode  --&gt;  other            
</code></pre>

<p>decode 是将其他编码  转换成 unicode</p>

<pre><code>decode ： other   --&gt;  unicode               
</code></pre>

<p>3. 注意区分字符集和字符编码。</p>

<pre><code>字符集是一个系统支持的所有抽象字符的集合，包括各种文字和符号。         
字符编码是一套法则，使用该法则，将一个字符集与另一个集合配对。       
字符集包括ASCII字符集，GB2312字符集，BIG5字符集，UNICODE字符集等        
</code></pre>

<p>4. UNICODE是字符集，UTF-8,UTF-16,UTF-32是三种字符编码方案。</p>

<p><strong>python的编码问题</strong></p>

<p>python在安装的时候，默认的编码是ASCII码(python3 的默认编码是UTF8)，当程序中出现非ASCII码时，程序会报错.          <br/>
在终端里，运行</p>

<pre><code>&gt;&gt;&gt; import sys
&gt;&gt;&gt; sys.getdefaultencoding()
'ascii'
</code></pre>

<p>可以看到，默认编码是ASCII码，看看&#8221;你好&#8221;是怎么编码的</p>

<pre><code>&gt;&gt;&gt; a = '你好'
&gt;&gt;&gt; a
'\xe4\xbd\xa0\xe5\xa5\xbd'
</code></pre>

<p>这是&#8221;你好&#8221;的<strong>utf-8</strong>编码，如果对a解码呢，解码就是转换成unicode</p>

<pre><code>&gt;&gt;&gt; a.decode('utf8')
u'\u4f60\u597d'
&gt;&gt;&gt; a = u'你好'
&gt;&gt;&gt; a
u'\u4f60\u597d'
</code></pre>

<p>可以看到，a被解码成unicode了，那对a编码呢，编码的定义是将unicode转换成其他编码，看看python会怎么处理</p>

<pre><code>&gt;&gt;&gt; a = '你好'
&gt;&gt;&gt; a.encode('utf8')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
UnicodeDecodeError: 'ascii' codec can't decode byte 0xe4 in position 0: ordinal not in range(128)
</code></pre>

<p><strong>报错了</strong>！为什么会报错呢？这是因为对a进行encode操作，实际的代码是</p>

<pre><code>unicode(a).encode('utf-8')
</code></pre>

<p>会先将a解码成unicode，但没有指定解码方式，会使用系统默认的ASCII码，进行解码，<strong>解码</strong>出错。         <br/>
而对unicode类型的字符串进行解码也是一样的道理，会先将unicode编码成ASCII码，<strong>编码</strong>出错。</p>

<pre><code>&gt;&gt;&gt; a = u'你好'
&gt;&gt;&gt; a.decode('utf8')
Traceback (most recent call last):
  File "&lt;stdin&gt;", line 1, in &lt;module&gt;
  File "/usr/lib/python2.7/encodings/utf_8.py", line 16, in decode
    return codecs.utf_8_decode(input, errors, True)
UnicodeEncodeError: 'ascii' codec can't encode characters in position 0-1: ordinal not in range(128)
</code></pre>

<p>所以，<strong>最好对unicode对象只做encode操作，对str对象只做decode操作</strong>            <br/>
前面都没有用print函数打印，这时因为print会对编码进行自动处理</p>

<pre><code>&gt;&gt;&gt; a = '你好'
&gt;&gt;&gt; print a.decode('utf8')
你好
</code></pre>

<p>因为print函数对编码做了自动处理，所以显示汉字，这个操作系统环境变量设置有关。</p>

<pre><code>&gt;&gt;&gt; a.decode('utf-8').encode('utf-8')
'\xe4\xbd\xa0\xe5\xa5\xbd'
&gt;&gt;&gt; print a.decode('utf8').encode('utf-8')
你好
</code></pre>

<p>系统默认编码是ASCII码，那怎么修改系统默认编码呢：</p>

<pre><code>&gt;&gt;&gt; import sys
&gt;&gt;&gt; reload(sys)
&gt;&gt;&gt; sys.setdefaultencoding('utf-8')
</code></pre>

<p>这样系统默认编码就是utf-8了。</p>

<pre><code>&gt;&gt;&gt; sys.getdefaultencoding()
'utf-8'
</code></pre>

<p>而在脚本文件里，如果没有<code>#coding:utf-8</code>，会发生什么情况呢？</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python2</span>
</span><span class='line'>
</span><span class='line'><span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&#39;你好&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p>运行程序，会报错：             <br/>
<code>SyntaxError: Non-ASCII character '\xe4' in file 1.py on line 4, but no encoding declared;</code>              <br/>
第四行不是ASCII码，出错，由打印的错误信息也可以看出系统默认编码是ASCII码</p>

<p>如果加上<code>#coding:utf-8</code>，则会默认将非ASCII码，编码成utf-8</p>

<p>OK，今天的研究就到这，以后有空再深入研究</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[solidot页面中的名言]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/07/14/solidot-about/"/>
    <updated>2013-07-14T18:39:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/07/14/solidot-about</id>
    <content type="html"><![CDATA[<p>偶然发现<a href="http://www.solidot.org/">solidot</a>页面有很多名言警句，而且都是很不错的句子，就写了一个脚本，把这些句子提取下来了。</p>

<pre><code>人人生而平等--美国独立宣言
冬天已经到来，春天还会远吗？--雪莱
对他们伟大领袖的无情，是一个民族强大的表现--普鲁塔克
计算机就跟比基尼一样，省去了人们许多的胡思乱想。--萨姆·尤因
我认为低智，偏执，思想贫乏是最大的邪恶。而聪明，达观，多知的人，比之别样的人更堪信任。--王小波
你自己的代码如果超过6个月不看，再看的时候也一样像是别人写--伊格尔森定律
自由的保证是什么?是对自己不再感到羞耻。——尼采
不要向邪恶低头，而是要更勇敢地继续与之对抗。——维吉尔
政府有无限种手段来制造垄断——穆瑞·罗斯巴德
人民不应该怕政府，政府才应该怕人民。
任何人均有其价值
真正的无知不是知识的缺乏，而是拒绝获取知识。——卡尔·波普尔
当某人告诉你：“不是钱，而是原则问题”时，十有八九就是钱的问题——胡巴尔德
手段的不纯洁，必然导致目的的不纯洁。--甘地
不要恐慌--《银河系漫游指南》
谁能最恰当地评价一个人，他的敌人还是他自己？
民主不能从上面给予，而必须从下面争取而来——给予的东西可以收回，但争取来的东西却收不回。——方励之
通往地狱的路，都是由善意铺成的。——哈耶克
大胆的假设，小心的求证；认真的做事，严肃的做人。 --胡适
一切拥有权力的人都有滥用权力为自己谋求私利的倾向；任何专制的国家的教育目的都是在极力降低国民的心智。 --孟德斯鸠
专制制度下只有两种人：一种是哑子，一种是骗子。我看今天的中国就是少数骗子在统治多数哑子。--王亚南
实力永远意味着责任和危险。 -- 罗斯福. T.
你不问我，我就不会说谎话。
我们是微软。反抗是徒劳的。你会被同化的
法律必须被信仰，否则形同虚设。--伯尔曼
异议是爱国的最高形式 --托马斯·杰弗逊
坚信比谎言更是真理的敌人。——尼采
已经集中起来的权力不会由于创造它的那些人的良好愿望而变为无害。--弗里德曼
什么都比不上厄运更能磨练人的德性。——莎士比亚
有两样重要产品出自伯克利：LSD和BSD*。我们不相信这是个巧合。--Jeremy S. Anderson
想了解一个人的个性，那就赋予他权力。--林肯
管得最少，就是最好的政府。-- 大卫·梭罗
所谓现实只不过是一个错觉，虽然这个错觉非常持久。--爱因斯坦
老大哥在看着你。--奥威尔
程序员的问题是你无法预料他在做什么，直到为时已晚--Seymour Cray
国家是为人而建立，而人不是为国家而生存。--爱因斯坦
与其被动地同意别人的看法，不如理智地表示反对，因为如果你信自己的智慧，那么你的异议正表明了更多的赞同。--罗素
硬件:计算机系统中可被踢的部分。--Jeff Pesis
花代价所换来的一点才智，抵过别人传授的数倍不止。
彼窃钩者诛，窃国者为诸侯。——庄子
疑人先自疑，律人先律己
如果你想走到高处，就要使用自己的两条腿！不要让别人把你抬到高处；不要坐在别人的背上和头上。 --尼采·F.W.
自由只有为了自由的缘故才能被限制。——约翰 罗尔斯
通往地狱的路，都是由善意铺成的——哈耶克
柔和回答， 使怒消退。 言语暴戾， 触动怒气——箴言篇 15:1
具有新想法的人在其想法实现之前是个怪人。
自古至今，容忍的总是老百姓，被容忍的总是统治者--殷海光
不管我们已经观察到多少只白天鹅，都不能确立“所有天鹅皆为白色”的理论。只要看见一只黑天鹅就可以驳倒它。——卡尔·波普尔
没有一个人的记性，好到可以作个成功的说谎者——林肯
渴求美德而非奖赏。
哪里没有财产权，哪里就没有正义。--弗里德里克·哈耶克
不管民主的定义是什么，没有新闻自由， 民主本身就无法存在。--希尔斯曼
所谓科学的论辩，从总体上来说则是没有多大效果的，更不用说论辩几乎总是各持己见的这个事实。——弗洛伊德
以眼还眼，世界只会更盲目。--甘地
善待他人，即是最善待自己。
工作撵跑三个魔鬼：无聊、堕落和贫穷。
死会引人哭泣。虽则如此，人生的三分之一却在睡眠中打发掉了。--拜伦
发现可能性的界限的唯一办法就是越过这个界限，到不可能中去。--阿瑟·克拉克
科学必须始于神话，并伴随着对神话的批判。——卡尔·波普尔
财富并非供人拥有，而是供人享受。
所谓自由就是可以说二加二等于四的自由。--奥威尔
640K对每一个人来说都已足够--比尔盖茨
所谓爱国心，是指你既生为这个国家的国民，对于这个国家，当比对其他一切的国家信仰得高贵优越。--萧伯纳
人们还往往把真理和错误混在一起去教人，而坚持的却是错误。--歌德
一个从未犯错的人是因为他不曾尝试新鲜事物。--爱因斯坦
千里之行始于足下，九层之台起于垒土。
计算机没什么用。他们只会告诉你答案。--毕加索
人是天生的政治动物。--亚里士多德
世间最庄严的问题是：我能做什么好事？
如果我们过于爽快地承认失败，就可能使自己发觉不了我们非常接近于正确。——卡尔·波普尔
与魔鬼战斗的人，应当小心自己不要成为魔鬼。当你远远凝视深渊时，深渊也在凝视你。——尼采
自由意味着责任，正因为如此，多数人都惧怕自由。--萧伯纳
我不像你一样是一个机器人，让磁盘把我淹没，除非它们是小甜饼，并且只在嘴里。
人民大多数比我们想象的要蒙昧得多，所以宣传的本质就是坚持简单和重复。--戈培尔
首先他们无视于你，而后是嘲笑你，接着是批斗你，再来就是你的胜利之日。--甘地
要节约用水，尽量和女友一起洗澡--加菲猫
集体主义只不过是暴政的外衣。——莱辛
我讨厌星期一。--加菲猫
一个人知道自己为什么而活，就可以忍受任何一种生活。——尼采
每个人都受两种教育，一种来自别人，另一种更重要的是来自自己。--爱德华·吉本
真理是时间之产物，而不是权威之产物 --弗兰西斯·培根
别向医生和律师提供错误的消息。
评断一个国家的品格，不仅要看它培养了什么样的人民，还要看它的人民选择对什么样的人致敬，对什么样的人追怀。 --约翰·肯尼迪
在所有的禁欲道德里，人把自己的一部分视为神，加以崇拜，因此被迫把其他部分加以恶魔化。——尼采
在认识一切事物之后，人才能认识自己，因为事物仅仅是人的界限。——尼采
如果你点燃了真理的烛光，追求真理的人们就能够发现你。——路德维希·冯·米塞斯
所有小说写的都是真事。怕吓着你们才叫小声说。 --王朔
在b进位制中，以数n起头的数出现的机率为logb(n + 1) − logb(n)--本福特定律
在民主和独裁的斗争中，纸上的宪法敌不过独裁者的刺刀。——林语堂
我向星星许了个愿。我并不是真的相信它，但是反正也是免费的，而且也没有证据证明它不灵。--加菲猫
你在活着的同时，也在学习着，无论如何，你活着。--道格拉斯·亚当斯
会玩的人才会学
没有人足够完美，以至可以未经别人同意就支配别人。--林肯
百善孝为先，论心不论迹，论迹贫家无孝子；万恶淫为首，论迹不论心，论心世上少完人
想在善和恶中作造物主的人，必须首先是个破坏者，并砸烂一切价值。也就是说，最大的恶属于最高的善。不过，后者是创造性的善。--尼采
以术治国，政以贿成，吏治日坏，民生多艰
在这个世界上我只确定一件事。那就是人确定的事情越少越好。--毛姆
任何有可能出错的事将会出错--墨菲定理
罗马帝国灭亡的其中一个主要原因是他们没有0 - 这样他们就没法给自己的C程序指明成功退出的路--Robert Firth
谁控制过去就控制未来，谁控制现在就控制过去。--奥威尔
公安怎样公，猪公、狗公、乌龟公，公心何在？公理何存？每事假公图利禄；公局什么 局，酒局、肉局、大烟局，局内者欢，局外者苦，几时结局得安宁！
我注意过，即便是那些声称一切都是命中注定的而且我们无力改变的人，在过马路之前都会左右看。--史提芬·霍金
就算它工作不正常也别担心。如果一切正常，你早该失业了--Mosher的软件工程定律
读古人的书，一方面要知道古人聪明到怎样，一方面也要知道古人傻到怎样。--胡适
资讯是民主社会的流通货币--杰弗逊
若欲求长寿，生活须行善，因为蠢行和邪恶会把生命缩短。
国家是危险的机器--华盛顿
也许我是错而你是对，但只有我们一起努力，才能更接近真理。——卡尔·波普尔
如果你怀疑自己，那么你的立足点确实不稳固了。
喜爱孤独者，非神即兽。--亚里士多德
爱国主义就是积极地为了微不足道的原因杀人并被杀。——勃特兰·罗素
爱国者的责任就是保护国家不受政府侵犯——托马斯·潘恩
实现明天理想的唯一障碍是今天的疑虑。
太阳绝不为它所做的善事后悔，也从不指望任何报酬。
尊重人不应该胜于尊重真理。--柏拉图
成功的骗子，不必再说谎以求生，因为被骗的人，全成为他的拥护者，我再说什么也是枉然。--莎士比亚
肚子大不可怕，可怕的是肚子里没有好东西。--加菲猫
哪里没有财产权，哪里就没有正义。——哈耶克
战争即和平，自由即奴役，无知即力量。--奥威尔
活了一百年却只能记住30M字节是荒谬的。你知道，这比一张压缩盘还要少。人类境况正在变得日趋退。--Marvin Minsky
工欲善其事，必先利其器。居是邦，事其大夫之贤者，友其士之仁者。
我并不同意你的观点，但是我誓死捍卫你说话的权利——伏尔泰
为眼睛近视者指引道路是很费力的，因为你不能对他说：“看见十哩外的教堂吗?朝这个方向走。——维特根斯坦
想想看吧，已经有一百万只猴子坐在一百万台打字机旁，可Usenet就是比不上莎士比。--Blair Houghton
只有两种编程语言：一种是天天挨骂的，另一种是没人用--Bjarne Stroustrup
每一个帝国在即将建立的时候，都富于朝气，希望和成功的光芒；然而一旦皇帝登基，这一切都会荡然无存，留下的只有象征腐朽和无意义的各种仪式典礼。--《沙丘》
只要有了和平、低税收和宽容的司法当局，一个国家要达到最高富裕水平不需要其它东西。——亚当·斯密
天地不仁，以万物为刍狗；圣人不仁，以百姓为刍狗。 --老子
世界上只有两个东西是无限的，一为宇宙，一为人类的愚蠢，我所不能肯定的乃是前者。 --爱因斯坦
我每天只吃四类食物：早饭、午饭、晚饭和零食。--加菲猫
爱国主义是一种有害的、精神错乱的白痴形式。--萧伯纳
我爱你，与你无关。--歌德
身为一个中国人，最大的痛苦时忍受别人“推己及人”的次数，比世界上任何地方的人都要多。--小波
爱国主义：一堆随时可以被任何野心家所点燃，去照亮他的名字的易燃垃圾。 ——安卜罗斯·皮尔斯
恐惧比利剑更伤人--《冰与火之歌》
明白事理的人使自己适应世界；不明事理的人想使世界适应自己。所以，所有进步都要靠不明事理的人。--萧伯纳
所有动物生来平等，但有些动物比其他动物更平等。--奥威尔
对骄傲的人不要谦逊，对谦逊的人不要骄傲。--托玛斯·杰弗逊
宗教上最深的误解——认为坏人没有宗教。——尼采
一个有政治自由的国家固然不能说就是天堂，一个无政治自由的国家确是地狱了。--蒋廷黻
从前的愚民政策是不许人民受教育，现代愚民政策是只许人民受某一种教育。不受教育的人，因为不识字，上人的当，受教育的人，因为识了字，上印刷品的当。--钱钟书
尊严不值钱，却是我唯一真正拥有的！
把理想运用到真实的事物上，便有了文明。
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python2 装饰器、魔术方法和元类]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/06/30/about-python/"/>
    <updated>2013-06-30T19:41:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/06/30/about-python</id>
    <content type="html"><![CDATA[<h2>装饰器</h2>

<p>装饰器从字面上看，是一个起到装饰作用的工具，而这个工具其实还是函数，起到装饰函数的作用。也就是说，装饰器是一个用来装饰函数的函数，实现对函数的修改。来看一个例子。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">br</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">():</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&#39;&lt;br&gt;&#39;</span> <span class="o">+</span> <span class="n">fn</span><span class="p">()</span><span class="o">+</span> <span class="s">&#39;&lt;/br&gt;&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span class='line'>
</span><span class='line'><span class="k">def</span> <span class="nf">li</span><span class="p">(</span><span class="n">fn</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">wrapped</span><span class="p">():</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&#39;&lt;li&gt;&#39;</span> <span class="o">+</span> <span class="n">fn</span><span class="p">()</span><span class="o">+</span> <span class="s">&#39;&lt;/li&gt;&#39;</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">wrapped</span>
</span><span class='line'>
</span><span class='line'><span class="nd">@br</span>
</span><span class='line'><span class="nd">@li</span>
</span><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&#39;Hello&#39;</span>
</span><span class='line'><span class="k">print</span> <span class="n">hello</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>输出的结果是：         <br/>
<code>&lt;br&gt;&lt;li&gt;Hello&lt;/li&gt;&lt;/br&gt;</code></p>

<p>@称之为语法糖，我们把</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="nd">@li</span>
</span><span class='line'><span class="nd">@br</span>
</span><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&#39;Hello&#39;</span>
</span><span class='line'><span class="k">print</span> <span class="n">hello</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p>     <br/>
展开，可以等价为</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">hello</span><span class="p">():</span>
</span><span class='line'>    <span class="k">return</span> <span class="s">&#39;Hello&#39;</span>
</span><span class='line'><span class="k">print</span> <span class="n">li</span><span class="p">(</span><span class="n">br</span><span class="p">(</span><span class="n">hello</span><span class="p">))()</span>
</span></code></pre></td></tr></table></div></figure>


<p>   <br/>
需要注意的是，装饰器的顺序很重要，装饰器必须在引用前定义，例子中的li和br如果在hello函数之后定义，运行的时候程序将会报错。</p>

<p>装饰器说明了一个问题，在Python中，函数也是对象，所以函数可以被赋给变量，可以作为参数进行参数传递，可以返回函数，也可以在函数中定义函数。</p>

<p>其实在python中，一切皆对象，类是对象，类中的方法也是对象，类实例的行为也可以表现的像函数一样。可以将类赋值给一个变量，类可以复制，可以增加属性，也可以作为参数传递。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">student</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">age</span> <span class="o">=</span> <span class="n">age</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Class initial.&#39;</span>
</span><span class='line'>        <span class="k">print</span> <span class="n">name</span><span class="p">,</span> <span class="n">age</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">sexy</span><span class="o">=</span><span class="s">&#39;Male&#39;</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Function is called.&#39;</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Name=</span><span class="si">%s</span><span class="s">, Age=</span><span class="si">%s</span><span class="s">, Sexy=</span><span class="si">%s</span><span class="s">&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">age</span><span class="p">,</span> <span class="n">sexy</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="n">xiaoming</span> <span class="o">=</span> <span class="n">student</span><span class="p">(</span><span class="s">&#39;xiaoming&#39;</span><span class="p">,</span> <span class="s">&#39;8&#39;</span><span class="p">)</span>
</span><span class='line'><span class="n">xiaoming</span><span class="p">()</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>输出：</p>

<pre><code>Class initial.          
xiaoming 8            
Function is called.               
Name=xiaoming, Age=8, Sexy=Male              
</code></pre>

<p>可以看到xiaoming这个类实例表现的像函数一样，调用xiaoming()的结果是执行了__call__方法，这个前后都带双下划线的方法称为魔术方法。通过魔术方法__call__，类实例表现出了函数的特征。</p>

<p>装饰器有很多用途，包括</p>

<ul>
<li>访问控制</li>
<li>清除临时对象</li>
<li>错误处理</li>
<li>缓存</li>
<li>日志</li>
</ul>


<p>来看一个缓存的例子：</p>

<pre><code>&gt;&gt;&gt; def cache(func):
...     c = {}
...     def wrapper(*args):
...         if args in c:
...             return c[args]
...         print 'Calling %s()' % func.__name__
...         res = func(*args)
...         c[args] = res
...         return res
...     return wrapper
&gt;&gt;&gt; @cache
... def mum(x,y):
...     return x*y
... 
&gt;&gt;&gt; mum(6,7)
Calling mum()
42
&gt;&gt;&gt; mum(6,7)
42
</code></pre>

<h2>魔术方法</h2>

<p>魔术方法很多，比如__enter__，__exit__。我们知道with函数的用法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;test.txt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&#39;Open file test.txt&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p> <br/>
with函数会自动执行__enter__和__exit__方法，在with开始执行的时候，就会调用__enter__方法，而在with函数结束的时候调用__exit__方法，open的__exit__会自动关闭文件，省去了显式调用close方法的步骤。</p>

<p>举个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">Vipsl</span><span class="err">：</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Class initial.&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__enter__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Enter Vipsl&#39;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__exit__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val1</span><span class="p">,</span> <span class="n">val2</span><span class="p">,</span> <span class="n">val3</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="s">&#39;Exit.&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">with</span> <span class="n">Vipsl</span><span class="p">()</span> <span class="k">as</span> <span class="n">v</span><span class="p">:</span>
</span><span class='line'>    <span class="k">print</span> <span class="s">&#39;processing...&#39;</span>
</span></code></pre></td></tr></table></div></figure>


<p></p>

<p>输出结果是：</p>

<pre><code>Class initial.      
Enter Vipsl      
processing...    
Exit.         
</code></pre>

<p>我们可以看到__exit__最后执行。</p>

<p>上例有最基本的魔法函数__init__，在创建对象时调用，可以视为C++中的构造函数，而__del__视为析构器。其实__init__并不是类实例化时所调用的第一个方法，第一个调用的方法是__new__。</p>

<p>当然也可以重载魔术方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#!/usr/bin/env python2</span>
</span><span class='line'><span class="c"># coding: utf-8</span>
</span><span class='line'>
</span><span class='line'><span class="kn">from</span> <span class="nn">collections</span> <span class="kn">import</span> <span class="n">defaultdict</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">my_dict</span><span class="p">():</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="bp">self</span><span class="o">.</span><span class="n">d</span> <span class="o">=</span> <span class="n">defaultdict</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">__contains__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span>  <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">__getitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">__setitem__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">get_hash</span><span class="p">(</span><span class="n">name</span><span class="p">),</span> <span class="n">value</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">get_hash</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="nb">hash</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">keys</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
</span><span class='line'>        <span class="k">print</span> <span class="bp">self</span><span class="o">.</span><span class="n">d</span><span class="o">.</span><span class="n">keys</span><span class="p">()</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">my_bag</span><span class="p">(</span><span class="nb">dict</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">dict</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__getattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">):</span>
</span><span class='line'>        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__setattr__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="n">name</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="p">[</span><span class="n">name</span><span class="p">]</span> <span class="o">=</span> <span class="n">value</span>
</span><span class='line'>
</span><span class='line'><span class="n">y</span> <span class="o">=</span> <span class="n">my_dict</span><span class="p">()</span>
</span><span class='line'><span class="n">y</span><span class="p">[</span><span class="s">&#39;test&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Hello world!&#39;</span>
</span><span class='line'><span class="n">y</span><span class="p">[</span><span class="s">&#39;test2&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="s">&#39;Hello world!&#39;</span>
</span><span class='line'><span class="k">print</span> <span class="n">y</span><span class="p">[</span><span class="s">&#39;test&#39;</span><span class="p">]</span>
</span><span class='line'><span class="k">print</span> <span class="s">&#39;test&#39;</span> <span class="ow">in</span> <span class="n">y</span>
</span><span class='line'>
</span><span class='line'><span class="n">bag</span> <span class="o">=</span> <span class="n">my_bag</span><span class="p">()</span>
</span><span class='line'><span class="n">bag</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s">&#39;hello bag&#39;</span>
</span><span class='line'><span class="k">print</span> <span class="n">bag</span><span class="o">.</span><span class="n">name</span>
</span><span class='line'><span class="k">print</span> <span class="n">bag</span><span class="o">.</span><span class="n">fd</span>
</span><span class='line'><span class="k">print</span> <span class="n">bag</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出</p>

<pre><code> Hello world!         
 True        
 hello bag          
 None               
 {'name': 'hello bag'}       
</code></pre>

<h2>元类</h2>

<p>说到__new__，就涉及到元类的概念了。     <br/>
元类就是类的类。     <br/>
我们知道类可以使用class关键字来定义，这时候python解释器会自动创建这个对象，但类也是对象，像其他对象一样，为了生成类，python也会提供一个手动处理的方法，这个方法就是type。type创建类的格式是：       <br/>
<code>type(类名，父类元组，属性字典)</code></p>

<p>举个例子：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">student</span><span class="p">(</span><span class="n">person</span><span class="p">)</span><span class="err">：</span>
</span><span class='line'>    <span class="n">SmallThan18</span> <span class="o">=</span> <span class="bp">True</span>
</span></code></pre></td></tr></table></div></figure>


<p>那么用type创建就是：</p>

<p><code>student = type('student', ('person'), {'SmallThan18':True})</code></p>

<p>可以看到，type创建了一个类。其实type就是元类，而且是python中创建所有类的元类。
str是类，int也是类，从这些类中可以创建出字符串对象，整型对象，而str类和int类的元类也是type。</p>

<p>我们可以从__class__属性中看出端倪。</p>

<pre><code>&gt;&gt;&gt; a = 'hello world'
&gt;&gt;&gt; a.__class__
&lt;type 'str'&gt;
&gt;&gt;&gt; a.__class__.__class__
&lt;type 'type'&gt;
</code></pre>

<p>字符串a是从str类而来，str类来自元类type，那么a.__class__.__class__.__class__是什么呢？还是type。</p>

<p>type是元类，当然我们可以创建自己的元类，这就是__metaclass__。如果指定了__metaclass__，那么，这个类将不会由type创建，而是由指定的__mataclass__创建，那么__metaclass__是什么呢？其实就是可以创建类的东西，可以是一个类（来自type），也可以是type。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">mc</span><span class="p">(</span><span class="nb">type</span><span class="p">):</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">base</span><span class="p">,</span> <span class="nb">dict</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="s">&#39;nlist&#39;</span><span class="p">):</span>
</span><span class='line'>            <span class="n">cls</span><span class="o">.</span><span class="n">nlist</span> <span class="o">=</span> <span class="p">[]</span>
</span><span class='line'>        <span class="k">else</span><span class="p">:</span>
</span><span class='line'>            <span class="n">cls</span><span class="o">.</span><span class="n">nlist</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">person</span><span class="p">:</span>
</span><span class='line'>    <span class="n">__metaclass__</span> <span class="o">=</span> <span class="n">mc</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">student</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
</span><span class='line'>    <span class="n">SmallThan18</span> <span class="o">=</span> <span class="bp">True</span>
</span><span class='line'>
</span><span class='line'><span class="k">class</span> <span class="nc">gilrs</span><span class="p">(</span><span class="n">person</span><span class="p">):</span>
</span><span class='line'>    <span class="n">Sexy</span> <span class="o">=</span> <span class="s">&#39;Female&#39;</span>
</span><span class='line'>
</span><span class='line'><span class="k">print</span> <span class="n">student</span><span class="o">.</span><span class="n">nlist</span>
</span></code></pre></td></tr></table></div></figure>


<p>输出：   <br/>
<code>['student', 'gilrs']</code></p>

<p>可以看到mc其实是type的子类，任意person的子类名，都会放到nlist里面。定义type的时候注意，要符合type的参数定义格式。就是：      <br/>
<code>type(类名，父类元组，属性字典)</code></p>

<p>回到__new__属性，记不记得前面讲的__call__，那么type是不是可以类实例函数化，所以     <br/>
<code>type(类名，父类元组，属性字典)</code><br/>
等价为     <br/>
<code>type(类名).__call__(类名，父类元组，属性字典)</code></p>

<p>而在__call__的实现中，是先尝试用__new__来创建类实例的，只有__new__返回了类的实例，__init__才会执行。
可以这样表示：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">def</span> <span class="nf">__call__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
</span><span class='line'>    <span class="n">result</span> <span class="o">=</span> <span class="n">cls</span><span class="o">.</span><span class="n">__new__</span><span class="p">(</span><span class="n">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">result</span><span class="p">,</span> <span class="n">cls</span><span class="p">):</span>
</span><span class='line'>        <span class="nb">type</span><span class="p">(</span><span class="n">result</span><span class="p">)</span><span class="o">.</span><span class="n">__init__</span><span class="p">(</span><span class="n">result</span><span class="p">,</span><span class="o">*</span><span class="n">args</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">result</span>
</span></code></pre></td></tr></table></div></figure>


<p>参考资料：   <br/>
<a href="http://blog.danmarner.com/me/entry/python-new-metaclass-init-plugin-system/">http://blog.danmarner.com/me/entry/python-new-metaclass-init-plugin-system/</a>       <br/>
<a href="http://blog.jobbole.com/21351/">http://blog.jobbole.com/21351/</a></p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Ubuntu Touch Developer Preview Runs in My Galaxy Nexus]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/05/25/ubuntu-in-nexus/"/>
    <updated>2013-05-25T19:38:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/05/25/ubuntu-in-nexus</id>
    <content type="html"><![CDATA[<p><img src="http://i.imgur.com/DK4RATL.jpg" alt="ubuntu" />         <br/>
*I tried to install the ubuntu touch preview in my Galaxy nexus several mouths ago and i made it.</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python库openpyxl操作excel]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/04/30/python-excel/"/>
    <updated>2013-04-30T19:37:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/04/30/python-excel</id>
    <content type="html"><![CDATA[<p>最近一直在研究用python操作windows平台下的excel，对数据进行处理。目前操作excel的python库比较多，有xlwt、xlrd、pyexcelerator、openpyxl、win32com等，功能不一，各有优劣。</p>

<p>xlwt、xlrd、pyexcelerator针对excel2007（不包括）以前版本，生成的excel后缀是xls，而我的需求中需要支持excel2007及以上版本，文件后缀名是xlsx，这时就只有选用openpyxl或者win32com了。</p>

<p>有必要说一下，为什么得选用xlsx版本。因为xls的列数有最大256的限制，xlsx没有，而需要处理的数据列数是超过256的，有700多列。</p>

<p>win32com是python到VBA的接口，python利用win32com直接调用office API，在windows下兼容性好。office下的所有功能，都可以通过这个接口用python实现，但是，它有一个致命的缺点，速度慢。它是所有操作excel的库中最慢的一个。一个win32com的程序，处理120多行，700多列的数据，花了近一个半小时！</p>

<p>最后，选用openpyxl库，这个库文档不是很完整，遇到问题只有google和看源码。写出来运算速度还是比较令人满意的，处理相同的数据，只花了30s！！比win32com效率提升180倍！！</p>

<p>openpyxl可以实现很多excel的功能，我关注的功能包括合并单元格，调整单元格大小，设置单元格背景颜色，设置文本字体、大小、颜色等，都能轻易实现。</p>

<p>代码不在本机，就不上了。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Mini2440 实现软件路由]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/03/13/mini2440/"/>
    <updated>2013-03-13T19:33:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/03/13/mini2440</id>
    <content type="html"><![CDATA[<p>（硬件配置：Mini2440嵌入式电路板，外置网卡芯片是DM9601的usb有线网卡）</p>

<p>1.配置内核，使支持iptables，usbnet和mii，交叉编译内核（usbnet和mii主要是为了支持usb网卡，注意是编译到内核，不是编译成模块），将内核移植到Mini2440。</p>

<p>2.交叉编译iptables和usb网卡驱动qf9700，后者是单独的模块qf9700.ko，下载到板上insmod即可（不用modprobe usbnet），可ifconfig eth1看到设备。</p>

<p>3.交叉编译libpcap，版本是0.9，命令大致如下</p>

<blockquote><p>./configure –host=arm-linux</p></blockquote>

<p>编辑Makefile，更改—prefix，使为arm-linux-gcc原目录下的arm-non-。。。。</p>

<pre><code>make 
make install
</code></pre>

<p>4. 交叉编译h3cclient，注意Makefile的编写，编译器应该修改为arm-linux-g++</p>

<p>附上Makefile</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='makefile'><span class='line'><span class="nv">OBJECT</span> <span class="o">=</span> main.o dot1x.o md5.o
</span><span class='line'><span class="nv">LIBS</span> <span class="o">=</span> -lpcap
</span><span class='line'><span class="nv">TARGET</span> <span class="o">=</span> h3cclient
</span><span class='line'><span class="k">$(</span>TARGET<span class="k">)</span>: <span class="k">$(</span>OBJECT<span class="k">)</span>
</span><span class='line'>arm-linux-g++ -o <span class="k">$(</span>TARGET<span class="k">)</span> <span class="k">$(</span>OBJECT<span class="k">)</span> <span class="k">$(</span>LIBS<span class="k">)</span>
</span><span class='line'>main.o: main.cpp dot1x.h
</span><span class='line'>arm-linux-g++ -c main.cpp
</span><span class='line'>dot1x.o: dot1x.cpp dot1x.h md5.h
</span><span class='line'>arm-linux-g++ -c dot1x.cpp
</span><span class='line'>md5.o: md5.cpp md5.h
</span><span class='line'>arm-linux-g++ -c md5.cpp
</span><span class='line'>clean:
</span><span class='line'>rm -f <span class="k">$(</span>OBJECT<span class="k">)</span> <span class="k">$(</span>TARGET<span class="k">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>客户端为xd-h3c，需要细微修改，将grep及ps相关代码注释，busybox版本有点陈旧，不支持部分选项。       <br/>
客户端的移植依赖libpcap-0.9.3，libgpg-error-1.1和libgcrypt-1.2.1，这些包的发布时间都是在06年前后，版本很重要，其他版本尝试过几次，都无法顺利移植。编译大同小异，都需要root权限</p>

<pre><code>./configure –host=arm-linux –prefix=/opt/…/arm- 
make 
make install
</code></pre>

<p>编译成功之后需要将相关的库文件libgpg-error.so，libgcrypt.so复制到嵌入式板/usr/lib目录，之后就可以共享上网了。</p>

<p>ifconfig eth0 -promisc关闭网卡混杂模式。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[关于OperationalError]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/02/03/operationerror/"/>
    <updated>2013-02-03T19:27:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/02/03/operationerror</id>
    <content type="html"><![CDATA[<p>往mysql插入数据时，总是提示</p>

<blockquote><p>‘OperationalError: (1118, ‘Row size too large. The maximum row size for the used table type, not counting BLOBs, is 8126. You have to change some columns to TEXT or BLOBs’)</p></blockquote>

<p>起初以为是表设计的问题，将超过255的vachar更改成text后，还是报错。但是在另一台计算机上插入数据时，又没有问题。所以，我想可能是我本地mysql配置的问题。网上搜索一下，发现果真是配置的问题。        <br/>
在mysql配置文件my.cnf中修改或者添加：</p>

<pre><code>[mysqld]
max_allowed_packet = 16M
innodb_file_per_table=1
innodb_file_format='Barracuda'
</code></pre>

<p>注意mysql的配置文件一定要加上<code>innodb_file_format=’Barracuda</code> ’, 不然会报错</p>

<blockquote><p>requires innodb_file_format > Antelope</p></blockquote>

<p>在设计表时，添加 <code>ROW_FORMAT=COMPRESSED</code></p>

<p>另外，插入数据时，某些字符插入时会产生警告</p>

<blockquote><p>Warning: Incorrect string value: ‘\xD0\x91\xD0\xB8\xD1\x82…’ for column…</p></blockquote>

<p>解决方法是修改表列类型</p>

<pre><code>ALTER TABLE table_name MODIFY COLUMN column_name TEXT CHARACTER SET utf8 COLLATE utf8_general_ci NULL
</code></pre>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Python和mysql]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/01/13/mysql-python/"/>
    <updated>2013-01-13T19:25:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/01/13/mysql-python</id>
    <content type="html"><![CDATA[<p>用python操作mysql很方便，主要运用MySQLdb库。Arch可以直接敲以下命令安装：</p>

<blockquote><p>pacman -S mysql-python</p></blockquote>

<p>我的任务很简单，在已经存在的数据库中插入，查询和更新数据。代码也很简单，首先创建与数据库的链接：</p>

<blockquote><p>self.conn = MySQLdb.connect(host=mysql_host, port=mysql_port, user=mysql_user, passwd=mysql_password, charset=&#8217;utf8&#8217;, use_unicode=True)</p></blockquote>

<p>然后获取游标：</p>

<blockquote><p>self.cursor = self.conn.cursor()</p></blockquote>

<p>选择数据库：</p>

<blockquote><p>conn.select_db(mysql_db)</p></blockquote>

<p>这样初始化就完成了，然后就可以执行SQL语句，进行数据库操作了。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="k">class</span> <span class="nc">MySQLHandler</span><span class="p">:</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">mysql_host</span><span class="p">,</span> <span class="n">mysql_user</span><span class="p">,</span> <span class="n">mysql_password</span><span class="p">,</span> <span class="n">mysql_db</span><span class="p">,</span> <span class="n">mysql_port</span><span class="p">):</span>
</span><span class='line'>        <span class="k">try</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">MySQLdb</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">host</span><span class="o">=</span><span class="n">mysql_host</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="n">mysql_port</span><span class="p">,</span> <span class="n">user</span><span class="o">=</span><span class="n">mysql_user</span><span class="p">,</span> <span class="n">passwd</span><span class="o">=</span><span class="n">mysql_password</span><span class="p">,</span> <span class="n">charset</span><span class="o">=</span><span class="s">&#39;utf8&#39;</span><span class="p">,</span> <span class="n">use_unicode</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">select_db</span><span class="p">(</span><span class="n">mysql_db</span><span class="p">)</span>
</span><span class='line'>        <span class="k">except</span> <span class="ne">Exception</span><span class="p">,</span> <span class="n">e</span><span class="p">:</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span> <span class="o">=</span> <span class="bp">None</span>
</span><span class='line'>    <span class="c"># 插入</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">add_row</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">bag</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">:</span>
</span><span class='line'>            <span class="n">sql</span> <span class="o">=</span> <span class="s">&#39;INSERT INTO </span><span class="si">%s</span><span class="s"> (</span><span class="si">%s</span><span class="s">) VALUES(</span><span class="si">%s</span><span class="s">);&#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">table</span><span class="p">,</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">bag</span><span class="o">.</span><span class="n">keys</span><span class="p">()),</span> <span class="s">&#39;,&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="s">&#39;</span><span class="si">%s</span><span class="s">&#39;</span><span class="p">]</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">bag</span><span class="p">)))</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">(</span><span class="n">bag</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
</span><span class='line'>    <span class="c"># 查询</span>
</span><span class='line'>    <span class="k">def</span> <span class="nf">select_table</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">select_id</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">params</span><span class="p">,</span> <span class="n">params_value</span><span class="p">):</span>
</span><span class='line'>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="p">:</span>
</span><span class='line'>            <span class="n">sql</span> <span class="o">=</span> <span class="s">&#39;SELECT </span><span class="si">%s</span><span class="s"> FROM </span><span class="si">%s</span><span class="s"> WHERE </span><span class="si">%s</span><span class="s"> = &#39;</span> <span class="o">%</span> <span class="p">(</span><span class="n">select_id</span><span class="p">,</span> <span class="n">table</span><span class="p">,</span> <span class="n">params</span><span class="p">)</span> <span class="o">+</span> <span class="s">&#39;</span><span class="si">%s</span><span class="s">;&#39;</span>
</span><span class='line'>            <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="n">sql</span><span class="p">,</span> <span class="p">(</span><span class="n">params_value</span><span class="p">,</span> <span class="p">))</span>
</span><span class='line'>            <span class="n">r</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">cursor</span><span class="o">.</span><span class="n">fetchone</span><span class="p">()</span>
</span><span class='line'>            <span class="k">if</span> <span class="n">r</span><span class="p">:</span>
</span><span class='line'>                <span class="k">return</span> <span class="n">r</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</span><span class='line'>            <span class="k">else</span><span class="p">:</span>
</span><span class='line'>                <span class="k">return</span> <span class="s">&#39;&#39;</span>
</span></code></pre></td></tr></table></div></figure>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[SVM和topic model工具箱在64位Archlinux上的安装]]></title>
    <link href="http://xdbaqiao.github.io/blog/2013/01/03/svm-in-archlinux/"/>
    <updated>2013-01-03T11:09:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2013/01/03/svm-in-archlinux</id>
    <content type="html"><![CDATA[<p>最近在用Matlab做实验，遇到不少问题，本机是64位Archlinux，折腾一下，把问题解决了。</p>

<p>1.安装libsvm库        <br/>
版本选用libsvm加强版<a href="http://ishare.iask.sina.com.cn/f/20595187.html">libsvm-mat-2.89-3[FarutoUltimate3.0Mcode].rar</a>，因为程序中有函数scaleForSVM的调用，所以需要包含 <code>scaleForSVM.m</code> 程序的版本。下载之后，需要对源文件目录位置做些微调。把文件夹implement里面的文件拷到主文件夹，修改主文件夹的Makefile路径为matlab软件安装目录，并且在matlab中添加路径常量，注意不要把子文件夹添加进去了，然后 <code>!make</code> ，成功搞定！</p>

<p>2.安装topictoolbox
topictoolbox需要重新编译，如果未编译会出现如下错误：</p>

<pre><code>Attempt to execute SCRIPT GibbsSamplerLDA as a function:
/usr/local/share/matlab/toolbox/topictoolbox/GibbsSamplerLDA.m

Error in exampleLDA1 (line 47)
[ WP,DP,Z ] = GibbsSamplerLDA( WS , DS , T , N , ALPHA , BETA , SEED , OUTPUT );

Error in run (line 74)
evalin('caller',[script ';']);

Error in LDA (line 27)
run 'exampleLDA1';'
</code></pre>

<p>版本选用<a href="http://psiexp.ss.uci.edu/research/programs_data/toolbox.htm">最新版本</a>，支持64位操作系统。编译时，在Matlab中切换目录到工具箱所在目录，然后执行 <code>compilescripts</code> ，编译成功之后，topictoolbox就可以使用了，在某些情况下，需要sudo权限执行编译这个步骤。</p>
]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[rm -rf *]]></title>
    <link href="http://xdbaqiao.github.io/blog/2012/12/30/06-29-rm/"/>
    <updated>2012-12-30T11:05:00+08:00</updated>
    <id>http://xdbaqiao.github.io/blog/2012/12/30/06-29-rm</id>
    <content type="html"><![CDATA[<p>失误，<code>rm -rf *</code>     <br/>
误删了好多东西，博客也没备份，这下全得重新整过。   <br/>
博客的文章挑几篇重新po上来了。</p>
]]></content>
  </entry>
  
</feed>
